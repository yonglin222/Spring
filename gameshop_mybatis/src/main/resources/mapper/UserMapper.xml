<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dw.gameshop_mybatis.mapper.UserMapper">
   <resultMap id="UserWithAuthorityMap" type="User">
       <id property="userName" column="user_name" />
       <result property="password" column="password" />
       <result property="email" column="email" />
       <result property="realName" column="real_name" />
       <result property="createdAt" column="created_at" />

       <association property="authority" javaType="Authority">
           <id property="authorityName" column="authority_name"/>
       </association>
   </resultMap>
    <select id="getUserByUserName" resultMap="UserWithAuthorityMap">
        select u.user_name, u.password, u.email, u.real_name,
            u.created_at, a.authority_name
        from user u
        join authority a
        on u.user_authority = a.authority_name
        where u.user_name = #{username}
    </select>
    <insert id="registerUser">
        insert into user (
        user_name,
        password,
        email,
        real_name,
        user_authority,
        created_at
        ) values (
        #{userDTO.userName},
        #{userDTO.password},
        #{userDTO.eamil},
        #{userDTO.real_name},
        'USER',
        now()
        )
    </insert>
</mapper>